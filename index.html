
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>和音判定ツール Chord Finder &middot; 構成音からコード名を判定</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 20px;
      }

      /* Custom container */
      /* .container-narrow { */
      /*   margin: 0 auto; */
      /*   max-width: 700px; */
      /* } */
      /* .container-narrow > hr { */
      /*   margin: 30px 0; */
      /* } */

      /* Main marketing message and sign up button */
      .jumbotron {
        text-align: center;
        padding-top: 10px;
      }
      .jumbotron h1 {
        font-size: 40px;
        line-height: 1;
        margin-top: 15px;
      }
      .jumbotron h2 {
        font-size: 26px;
        line-height: 1;
        margin-top: 8px;
      }
      .jumbotron p {
        font-size: 18px;
        margin-bottom: 0px;
      }
      .jumbotron .btn {
        font-size: 21px;
        padding: 14px 24px;
      }

      /* input */
      .aor {
        position: relative;
        margin: 30px;
        font-size: 22px;
      }
      .fm {
        position: absolute;
        top: 0;
        right: 0;
        padding: 9px 10px;
        color: #b7bcc8;
        border: 0;
        line-height: 0;
        background-color: transparent;
        box-shadow: none;
        border-radius: 0;
      }
      #single_text_input {
        font-size: 100%;
        height: 40px;
        width: 100%;
      }

      /* result */

      /* Supporting marketing content */
      .marketing {
        margin: 115px 0;
      }
      .marketing p + h4 {
        margin-top: 28px;
      }

      /* piano */
      .piano_table *{
        font-size: 30px;
      }
      .piano_table{
        border: solid 1px black;
        float:left;
        display: none;
      }
      .piano_upper{
        height: 0.7em;
      }
      .piano_lower{
        height: 0.5em;
      }
      .piano_upper_white1,
      .piano_upper_white2,
      .piano_upper_black{
        border-left: solid 1px black;
        border-top: solid 1px black;
        border-right: solid 1px black;
        border-bottom: solid 0px black;
      }
      .piano_upper_white1{
        width: 0.1em;
      }
      .piano_upper_black,
      .piano_upper_white2{
        width: 0.2em;
      }
      .piano_upper_black{
        background-color: black;
      }
      .piano_lower_white{
        border-left: solid 1px black;
        border-top: solid 0px black;
        border-right: solid 1px black;
        border-bottom: solid 0px black;
        width: 0.3em;
      }

    </style>
    <!-- <link href="css/bootstrap&#45;responsive.css" rel="stylesheet"> -->

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- <link rel="apple&#45;touch&#45;icon&#45;precomposed" sizes="144x144" href="ico/apple&#45;touch&#45;icon&#45;144&#45;precomposed.png"> -->
    <!-- <link rel="apple&#45;touch&#45;icon&#45;precomposed" sizes="114x114" href="ico/apple&#45;touch&#45;icon&#45;114&#45;precomposed.png"> -->
    <!--   <link rel="apple&#45;touch&#45;icon&#45;precomposed" sizes="72x72" href="ico/apple&#45;touch&#45;icon&#45;72&#45;precomposed.png"> -->
    <!--                 <link rel="apple&#45;touch&#45;icon&#45;precomposed" href="ico/apple&#45;touch&#45;icon&#45;57&#45;precomposed.png"> -->
    <!--                                <link rel="shortcut icon" href="ico/favicon.png"> -->
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Chord Finder</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="index.html">Home</a></li>
            <li><a href="http://ningenrikigaku.blogspot.jp/2016/10/blog-post.html" target="_blank">About</a></li>
            <li><a href="https://github.com/kkkgg" target="_blank">Contact</a></li>
            <!-- <li class="dropdown"> -->
            <!--   <a href="#" class="dropdown&#45;toggle" data&#45;toggle="dropdown" role="button" aria&#45;haspopup="true" aria&#45;expanded="false">Dropdown <span class="caret"></span></a> -->
            <!--   <ul class="dropdown&#45;menu"> -->
            <!--     <li><a href="#">Action</a></li> -->
            <!--     <li><a href="#">Another action</a></li> -->
            <!--     <li><a href="#">Something else here</a></li> -->
            <!--     <li role="separator" class="divider"></li> -->
            <!--     <li class="dropdown&#45;header">Nav header</li> -->
            <!--     <li><a href="#">Separated link</a></li> -->
            <!--     <li><a href="#">One more separated link</a></li> -->
            <!--   </ul> -->
            <!-- </li> -->
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


      <div class="jumbotron">
        <h1>Chord Finder</h1>
        <h2>和音判定ツール</h2>
        <p class="lead">構成音からコード名を判定します。</p>
      </div>

      <div id="app">
        <ul class="nav nav-tabs">
          <li id="tab-single" role="presentation" class="active"><a v-on:click.stop="switchSingle">個別</a></li>
          <li id="tab-multi" role="presentation"><a v-on:click.stop="switchMulti">一括</a></li>
        </ul>

        <div id="single_input" class="form-group">
          <div class="aor">
            <input type="text" id="single_text_input" class="form-control" v-model="searchText"  placeholder="ファシ♭ド"  >
            <button type="button" class="fm" v-on:click="clear">
              <span class="glyphicon glyphicon-remove"></span>
            </button>
          </div>

          <ul class="help-block" style="text-align:left; list-style-type:none">
            <li>※低い音から順に構成音を記述します。レファ#ラでもdf#aでもOK</li>
          </ul>
          <table class="table table-striped">
            <tr><th>コード</th><th>スコア</th></tr>
            <tbody>
            <tr v-for="rec in results()"><td class="">{{rec["chord"]}}</td><td>{{rec["score"]}}</td></tr>
            </tbody>
          </table>
        </div>

        <div id="multi_input" class="form-group" style="display:none;text-align:center">
          <label for="comment">構成音:</label>
          <textarea class="form-control" rows="9" id="elements_list" style="width:90%">
'入力例
ソシレ
ミ♭ラ♭シ♭
ドミソシ
FA#C
cegb♭e♭
レ　ドミソ
ドレソ
ドレ＃ファ＃
cd#f#a

ドミソシ♭レ
ドミソシ♭レファ
ドミソシ♭レファ#

ドミソシレ
ドミソシレファ
ドミソシレファ#

'ジミヘンコード
eg#dg
eg#bdg

'サンダーバード
5: d a e f# a# c#
4: c# g# c# e b e g
3: d# a# d# g b d
2: d a d f g# c f g# c

'難解コード
ド　ソレファ#
レ　ドレラ
ミレ♭ミシ♭
ミ♭レ♭ファソ

ドレラ
ファソシ
ソレファ#
ファソド#

ドレファ
ミシド＃
ドファシ
ドミファ
</textarea>
          <ul class="help-block" style="text-align:left; list-style-type:none">
            <li>※低い音から順に構成音を記述します。レファ#ラでもdf#aでもOK</li>
            <li>※改行区切りで入力すると、複数のコード名を一括で判定できます</li>
            <li>※先頭に'を入力するとコメント行となり無視されます</li>
          </ul>
          <button class="btn btn-large btn-primary" type="button" id="go_button">判定</button>
          <button class="btn btn-large btn-default" type="button" id="reset_button">リセット</button>

          <hr>

          <div id="result_area" class="form-group" style="display:none">
            <h4>判定結果:</h4>
            <!--
            <textarea class="form-control" rows="5" id="result_list" style="width:70%"></textarea>
            -->
            <div id="result_box"></div>
          </div>
        </div>
      </div>

      <hr>

      <div class="row-fluid marketing" >
        <div class="span6">
          <h4>開発目的と用途</h4>
          <p>このアプリは与えられた構成音からコード名を判定するためのツールです。</p>
          <p>耳コピや作曲・編曲などでにおけるコード譜の採譜で、不明なコードに出くわしたとき、それを解決することを意図しています。</p>
          <p>響きを大切にするため、へたに類似コードや近似の簡単コードに略さず、正確性と伝達性のバランスをとったものを目指しています。</p>
          <h4>オンコード(分数コード)対応</h4>
          <p>オンコードに対応したよいコード判別機が見つからなかったため、開発しました。</p>
        </div>

        <div class="span6">
          <h4>オンコードとコード譜</h4>
          <p>コード譜のように楽曲を和声の流れとしてとらえる場合は、ベース音が肝になるため、正しいベース音を付与したコードで採譜する必要があります。</p>
          <p>例えば曲の流れの中で出現する低い方からのレドミソをCadd9と採譜してしまうと、原曲とは響きが異なるものになります。</p>
          <p>この場合のレドミソは、ベースを加味してC/Dが正解となります。</p>
        </div>
      </div>

      <hr>

      <div id="tags">
        <h4>他のコード名を調べる</h4>
        <ul>
          <li v-for="tag in tags">
            <a href="index.html?text={{ encodeURIComponent(tag.name) }}">{{ tag.name }}</a>
          </li>
        </ul>
      </div>

      <hr>

      <div class="footer">
        <p>&copy; <a href="https://github.com/kkkgg" target="_blank">kkkgg</a> 2016</p>
      </div>

      <table class="piano_table">
        <tr class="piano_upper">
          <td colspan="2" class="piano_upper_white2"></td>
          <td colspan="2" class="piano_upper_black"></td>
          <td colspan="1" class="piano_upper_white1"></td>
          <td colspan="2" class="piano_upper_black"></td>
          <td colspan="2" class="piano_upper_white2"></td>
          <td colspan="2" class="piano_upper_white2"></td>
          <td colspan="2" class="piano_upper_black"></td>
          <td colspan="1" class="piano_upper_white1"></td>
          <td colspan="2" class="piano_upper_black"></td>
          <td colspan="1" class="piano_upper_white1"></td>
          <td colspan="2" class="piano_upper_black"></td>
          <td colspan="2" class="piano_upper_white2"></td>
        </tr>
        <tr class="piano_lower">
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
          <td colspan="3" class="piano_lower_white"></td>
        </tr>
      </table>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/chord_finder.js"></script>
    <script>
      // ==========================================================
      // Vies Helper
      // ==========================================================

      // 変換ツール
      var app_view = new Vue({
        el: '#app',
        data: {
          searchText: getParameterByName("text"),
          chord: ''
        },
        methods: {
          switchSingle: function(){
            $("#tab-multi").removeClass("active");
            $("#tab-single").addClass("active");
            $("#multi_input").hide();
            $("#single_input").show();
          },
          switchMulti: function(){
            $("#tab-single").removeClass("active");
            $("#tab-multi").addClass("active");
            $("#single_input").hide();
            $("#multi_input").show();
          },
          findDetail: function(text){
          },
          clear: function(){
            this.searchText = "";
          },
          results: function(){
            var text = this.searchText || "";
            changeTitle(text);
            return ChordFinder.findDetail(text)['result'];
          }
        }
      })

      function initPage(){
        // var text = getParameterByName("text");
        // if(text){
        //   // $("#elements_list").val(text);
        //   // $("#go_button").trigger("click");
        //   app_view.searchText = text;
        // }

        // ランダムタグ
        new Vue({
          el: '#tags',
          data: {
            tags: randomChordStrArray().map(function(e){
              return { name: e }
            })
          }
        })
      }

      function randomChordStrArray(){
          return randomSort(Object.keys(ChordFinder.getStandardChordMap()))
              .slice(0,8).map(function(e){
                  // ルート音のランダム選定
                  var tones = ChordFinder.getToneNames(getRandomInt(0,1) ? "#" : "♭");
                  var num = getRandomInt(0,tones.length-1);
                  var tone = tones[num];

                  // スケール取得しコンバート
                  var scale = rotateArray(tones, num);
                  var chord_str = e.split(",").map(function(e){
                      return scale[e];
                  }).join("");
                  return ChordFinder.toneToKana(chord_str);
              }
          );
      }

      // ==========================================================
      // Web Utility
      // ==========================================================


      // querystring
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      // タイトルとURL変更
      function changeTitle(str){
        var $title = $("title");
        str = ChordFinder.replaceComment(str);
        if(! $title.prop("original_title")) $title.prop("original_title", $title.text());
        var title;
        var url;
        if(str == ""){
          title = $title.prop("original_title");
          url = "index.html";
        }
        else{
          title = str + " のコード名 - " + $title.prop("original_title");
          url = "index.html?text=" + encodeURIComponent(str);
        }
        document.title = title;
        history.pushState(null, title, url);
      }

      // ==========================================================
      // 
      // ==========================================================

      $(function(){
        // 実行ボタンハンドラ
        $("#go_button").on("click", function(){
          // TODO インクリメンタルサーチ
          // var res_ary = [];
          var res_table = $('<table class="table table-striped table-sm">');
          res_table.append(
            $("<tr>")
              .append($("<th>").text("構成音"))
              .append($("<th>").text("コード名"))
          );
          var tbody = $("<tbody>");
          res_table.append(tbody);
          var str_ary = $("#elements_list").val().split("\n");
          str_ary.forEach(function(e){
              var res =ChordFinder.find(e);
              res = res instanceof Array ? res.join(" ") : res;
              tbody.append($("<tr>")
                .append($("<td>").text(e.replace("'","")))
                .append($("<td>").text(res))
                .addClass( (e != "" && !res) ? "info" : null)
              );
          });
          $("#result_box").empty().append(res_table);
          $("#result_area").show();
          // コピペしやすいようにc-a効くエリアが望ましい

          // // タイトルとURL変更
          // var first_str = str_ary[0] || "";
          // // 複数入力チェック
          // if(str_ary[1]) first_str = "";
        });

        // リセットボタンハンドラ
        $("#reset_button").on("click", function(){
          $("#elements_list").val("");
          $("#result_area").hide();
        });

        $("#single_text_input").focus();

        // 履歴ハンドラ
        $(window).on("popstate", function(e){
          e.preventDefault();
          initPage();
        });

        initPage();
      });
    </script>
  </body>
</html>

